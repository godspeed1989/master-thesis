%% ----------------------------------------------------------------------
%% START OF FILE
%% ----------------------------------------------------------------------

\chapter{相关技术简介}
\label{cha:related_work}

\section{固态硬盘（SSD）简介}
\label{sec:SSD}

固态硬盘（SSD，固态驱动器）是一种基于永久性存储介质的存储器，如闪存；或非永久性存储介质的存储器，如同步动态随机存取存储器（SDRAM）的计算机外部存储设备。固态硬盘出现是为了代替传统机械硬盘。相比于机械硬盘，固态硬盘中已经没有了可以旋转的盘状结构，但是依照存储设备的命名习惯，这类存储器仍被称作硬盘。依据存储介质的类型，可分为易失性和非易失性两类。

\begin{enumerate}
\item 基于易失性记忆体的SSD

由易失性记忆体制成的固态硬盘主要用于临时存储。这类记忆体需要外界电力维持其记忆，因此需要配合电池使用。易失性存储介质，例如SDRAM，具有访问速度快的特点。利用这一特点，可以将需要运行的程序首先从常规硬盘复制到固态硬盘中，然后交给计算机执行，由此可避免硬盘的启停延迟、寻道延迟对程序性能的影响。

此外，由易失性记忆体制成的固态硬盘还可用于应急备份。当电源意外中断时，靠电池驱动的SSD可以有足够的时间将数据转移到非易失存储设备。电力恢复后，再从非易失存储设备中恢复数据。

\item 基于非易失性记忆体的SSD

非易失性存储介质（NVRAM）的数据存取速度介于易失性介质和机械硬盘之间。和易失性介质相比，非易失性介质一经写入数据，无需外界电力来维持其记忆。更适于作为常规硬盘的替代品。

用于生产SSD的NVRAM主要有三种，分別是多层式储存颗粒（MLC，Multi Level Cell）、单层式储存颗粒（SLC，Single Level Cell）和三层式储存颗粒（TLC，Triple Level Cell）。SLC、MLC和TLC三者读取速度差异不大，使用MLC和TLC颗粒的固态硬盘的成本较使用SLC的低，但是寿命较短。

工业界使用P/E cycle衡量固态硬盘的使用寿命。由于单个存储颗粒的寿命（写入次数）有限，固态硬盘控制器通常会把写入平均分配到每个存储颗粒上，再通过映射表定位数据的实际存储位置。一个P/E cycle表示所有存储颗粒被写入一次，存储介质的P/E cycle值越大，寿命越长。

\begin{table}
\centering
\begin{tabular}{|c|c|c|c|}
\hline  & SLC NAND Flash & MLC NAND Flash & TLC NAND Flash \\
\hline P/E Cycles & 100,000 & 10,000 & 4,000 \\
\hline Cell type & 1bit/cell & 2bit/cell & 3bit/cell \\
\hline Price (USD/GB) & 5 & 1.4 & 1 \\
\hline
\end{tabular}
\caption{SLC、MLC和TLC的寿命和价格比较}
\label{tab:slc-mlc-tlc-compare}
\end{table}

从表\ref{tab:slc-mlc-tlc-compare}可以看出，存储颗的粒密度从SLC到TLC逐渐增大，而寿命逐渐减少。SLC颗粒常被用于生产企业硬盘，而MLC颗粒和TLC颗粒则较多的出现于桌面计算机的SSD中。虽然TLC颗粒的P/E cycle与SLC颗粒存在将近两个数量级的差距，但实际应用情况表明TLC颗粒完全可以满足桌面计算机的使用寿命要求。

非易失性SSD存在严重影响写入性能的Write cliff现象。Write cliff现象出现在所有存储颗粒的空闲页都已经被初始化写入，新的写请求无法一次性得到足够的空闲页以完成写入操作。此时需要SSD控制器擦除某些未写满的存储页面。控制器会将未写满的存储页面的原有数据拷贝到临时空间，再进擦除；将原有数据与新数据进行合并，写入到擦除后的存储页面。将原有数据拷贝到临时空间的时间消耗是Write cliff出现的主要原因。

SSD厂商为了减少Write cliff对性能的影响，加入了TRIM指令。当有文件需要被删除时，可通过TRIM指令会告知SSD被删除文件的位置，SSD控制器会将对应的存储块标记为空闲状态。这样，就能在一定程度上保证总是存在空闲页，从而降低Write cliff现象出现的概率。TRIM指令的出现，很大程度上提升了SSD的性能、延长了SSD的寿命，但当空闲页面无法满足写请求时，仍然需要擦除未写满的存储页面。TRIM指令只能推迟而无法避免Write cliff现象的出现。

\end{enumerate}

\section{缓存技术}
\label{sec:cache_tech}

尽管自二十世纪九十年代以来，计算机硬件技术的发展带来了磁盘存储密度每半年到一年一倍的提升，但没有相应的技术能够以同样的速度缩短存储介质的访问时间。缓存技术作为一种减少IO子系统的响应时间增加系统吞吐量的解决方案，已被广泛应用于存储子系统中。

缓存系统的存在通常是为了达到三个目标：
\begin{enumerate}
\item 减少交互的通讯量：缓存数据能有效减少在进程和机器间的传输量。
\item 降低系统中的处理量：记录处理结果，减少处理次数。
\item 降低磁盘访问次数：如HDD数据在内存中的缓存。
\end{enumerate}

在评估一个缓存系统的好坏时，会从性能、稳定性和可用性三个方面进行：
\begin{enumerate}
\item 性能：定量分析缓存系统的命中率和缩短的延迟。
\item 稳定性：缓存算法本身是否稳定性，对于意外情况（如掉电），能否保证数据完整。
\item 可用性：系统对客户应是透明的，客户得到的仅仅是快速的响应和良好的可用性。
\end{enumerate}

\section{混合存储系统}
\label{sec:hybrid_storage}

只要CPU和HDD访问速度仍然保持较大的差距，学术界和工业界就不会停止探索和研究利用不同速度的存储器件，搭建混合存储系统。提高存储系统性能、容量和可靠性等指标。近二十年的研究已经获得了众多有价值的研究成果。

\begin{enumerate}

\item 基于RAM与HDD的混合存储

使用内存作为HDD的缓存一直是提高存储系统性能的重要手段。几乎所有操作系统在设计磁盘驱动程序时，都会优先考虑使用DRAM缓存HDD数据。硬盘制造商在制造硬盘时，会在硬盘控制器中加入8~16MB的RAM芯片，利用数据的空间局部性原理，硬盘控制器在处理IO请求时读出的数据量会大于等于请求的数据量，进行缓存。

\item 高低转速磁盘的混合存储

HDD的磁盘物理转速直接决定了IO请求处理的快慢。利用不同规格、不同转速的 HDD 来设计混合存储系统在20世纪90年代曾成为产业界研究的热点。其基本思想是根据数据的访问频率、保留时间、重要性等指标，将频繁访问的热数据存储在转速为10000-15000 RPM的高速小容量SCSI HDD中，而将访问较少的冷数据存储在转速为5400-7200 RPM的低速大容量IDE/SATA HDD中。但由于HDD本身机械原理的限制，不同转速HDD之间的性能差距并不显著。因此，这种方法对存储系统的性能的提升非常有限。

\item 基于SSD和HDD的混合存储

SSD和HDD之间性能的良好互补性，以及近1~2年高寿命、高密度的SSD存储设备生产技术的日渐成熟，为设计高性能、低成本的混合存储系统提供了崭新的机遇。基于SSD和HDD的混合存储解决方案已成为大数据存储技术的新兴发展方向，并很快成为研究热点，其中企业存储解决方案提供商的发展尤其引人注目。Microsoft，LSI，Intel，EMC，IBM, Fusion-io等企业都已经或即将推出自己基于SSD混合存储的解决方案。

\end{enumerate}

\section{缓存算法评估}
\label{sec:cache_evaluation}

大多数学术论文在评估某种缓存算法的优劣时，都是只评估缓存的命中率。为了提高论文的说服力，有的还会给出该算法应用于某种环境所带来的性能提升比例。当工程师为混存系统挑选一种合适的缓存算法时，这些数据的参考价值都很有限，且不存在一种通用的评估方法。
下面介绍一种本论文提出并使用的缓存算法的评估模型，该模型既可以用于评估缓存算法给系统可能带来的性能提升，又可以为缓存系统工程师设计系统起到指导作用。

给出评估方法之前，式\ref{equ:cache_evaluation_syms}列出了推理中用到的数学符号。
\begin{equation}
\begin{split}
\\&T_1=\mbox{无缓存时，单个读/写请求处理时间}
\\&T_2=\mbox{有缓存且缓存命中时，单个读/写请求的处理时间}
\\&T_3=\mbox{有缓存但缓存时，单个读/写请求的处理时间}
\\&N=\mbox{读写请求总数量}
\\&R=\mbox{缓存命中率},R\in\lbrack0,1)
\\&T_q=\mbox{查询一个读/写请求在缓存池中是否命中的时长}
\\&T_c=\mbox{从缓存池拷贝或向缓存池写入完成一个读/写请求所需数据的时长}
\\&T_u=\mbox{使用单个未命中的读/写请求数据，更新缓存池所需时间}
\end{split}
\label{equ:cache_evaluation_syms}
\end{equation}

评估缓存对于系统IO性能的提升，可以用有、无缓存前提下，读写请求花费总时长的变化比例来表示。

\begin{equation}
\begin{split}
\mbox{性能提升比例}&=\frac{\mbox{无缓存条件下完成所有读写请求的总时长}}{\mbox{存在缓存时完成所有读写请求的总时长}}
\\&=\frac{NT_1}{NRT_2+N(1-R)T_3}
\\&=\frac{T_1}{RT_2+T_3-RT_3}
\\&=\frac{T_1}{T_3-(T_3-T_2)R}
\end{split}
\label{equ:cache_evaluation_enhance1}
\end{equation}

系统不存在缓存时，一个读/写请求所需的时间（$T_1$）等同于该读/写请求直接应用于存储介质上所需的时间。

系统存在缓存且请求命中时，缓存系统利用缓存中数据即可完成读/写请求。这时，一个读/写请求所需的时间（$T_2$）等同于查询缓存池所需时间（$T_q$）加上从缓存池拷贝或向缓存池写入完成一个读/写请求所需数据的时间（$T_c$）。
\begin{equation}
T_2=T_c+T_q
\end{equation}

系统存在缓存但未命中时，为了完成请求需要应用请求于存储介质，再使用获得的数据（读请求）或请求中包含的数据（写请求）更新缓存池。这时，一个读/写请求所需的时间（$T_3$）等同于查询缓存池所需时间（$T_q$），加上应用读/写请求于存储介质所需时间（$T_1$），再加上使用新数据更新缓存池所需的时间（$T_u$）。
\begin{equation}
T_3=T_q+T_1+T_u
\end{equation}

综上可以得出$T_2$与$T_3$的关系，同时，$T_3$也可以用$T_2$来表示（式\ref{equ:cache_evaluation_t2t3}）。

\begin{equation}
\label{equ:cache_evaluation_t2t3}
T_3-T_2=T_1+T_u-T_c
T_3=T_1+T2+T_u-T_c
\end{equation}

最后，将式\ref{equ:cache_evaluation_t2t3}带入到提升比例计算公式\ref{equ:cache_evaluation_enhance1}，得出式\ref{equ:cache_evaluation_enhance2}。

\begin{equation}
\begin{split}
\mbox{性能提升比例}&=\frac{T_1}{T_3-(T_3-T_2)R}
\\&=\frac{T_1}{(T_1+T_2+T_u-T_c)-(T_1+T_u-T_c)R}
\\&=\frac{T_1}{T_2+(T_1+T_u-T_c)(1-R)}
\\&=\frac{T_1}{T_q\textdownarrow+T_c+(T_1+T_u\textdownarrow-T_c)(1-R\textuparrow)}\textuparrow
\end{split}
\label{equ:cache_evaluation_enhance2}
\end{equation}

$T_1$取决于被缓存储介质的性能；$T_c$取决于缓存存储介质的性能。这两个值在硬件环境一定的情况下为定值。
提升缓存系统性能就是提高缓存系统为原系统带来的性能提升比例。式\ref{equ:cache_evaluation_enhance2}表明，可以从以下三个点着手：

\begin{enumerate}
\item
提高缓存池的查询速度，缩短查询时间$T_q$。
\item
提高缓存池的更新速度，缩短更新时间$T_u$。
\item
优化缓存算法，提高缓存命中率$R$。
\end{enumerate}

上面的三个着手点从工程的经验角度讲也是行得通的。

%% ----------------------------------------------------------------------
%%% END OF FILE
%% ----------------------------------------------------------------------